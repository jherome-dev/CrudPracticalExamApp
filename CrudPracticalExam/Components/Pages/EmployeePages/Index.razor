@page "/employees"
@attribute [Authorize]
@using Microsoft.AspNetCore.Authorization
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using CrudPracticalExam.Models
@using CrudPracticalExam.Data
@implements IAsyncDisposable
@inject IDbContextFactory<CrudPracticalExam.Data.ApplicationDbContext> DbFactory

<PageTitle>Employees</PageTitle>

<p>
    <a class="btn btn-primary" href="employees/create">Create New</a>
</p>

<QuickGrid Class="table table-striped table-hover table-bordered " Items="context.Employees">
    <PropertyColumn Property="employee => employee.FullName" />
    <PropertyColumn Property="employee => employee.Email" />
    <PropertyColumn Property="employee => employee.Position" />
    <PropertyColumn Property="employee => employee.Salary" />
    <PropertyColumn Property="employee => employee.DateHired" />

    <TemplateColumn Context="employee">
        <a class="btn btn-sm btn-primary me-1" href="@($"employees/edit?id={employee.Id}")">
            <i class="bi bi-pencil"></i> Edit
        </a>

        <a class="btn btn-sm btn-info me-1" href="@($"employees/details?id={employee.Id}")">
            <i class="bi bi-eye"></i> Details
        </a>

        <a class="btn btn-sm btn-danger" href="@($"employees/delete?id={employee.Id}")">
            <i class="bi bi-archive"></i> Delete
        </a>
    </TemplateColumn>
</QuickGrid>

@code {
    private ApplicationDbContext context = default!;

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();
    }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
